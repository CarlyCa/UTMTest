<script>
document.addEventListener("DOMContentLoaded", function () {
    function getQueryParam(param) {
        let urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    function getReferrerSource() {
        // Check for 'fbclid' in URL (Messenger, Facebook, Instagram)
        if (getQueryParam("fbclid")) {
            return "facebook.com";  // Assume Facebook if 'fbclid' is found
        }

        let storedReferrer = localStorage.getItem("original_referrer");
        if (storedReferrer) {
            return storedReferrer; // Use stored referrer if available
        }

        let referrer = document.referrer;
        if (!referrer) {
            return "direct"; // No referrer means user typed the URL manually
        }

        try {
            let referrerDomain = new URL(referrer).hostname; // Extract domain
            localStorage.setItem("original_referrer", referrerDomain); // Store referrer
            return referrerDomain; 
        } catch (error) {
            console.error("Referrer Error:", error);
            return "unknown"; // If an error occurs
        }
    }

    function updateFormstackIframe() {
        let formstackIframe = document.getElementById("formstack-embed");
        if (!formstackIframe) {
            console.error("ðŸš¨ Formstack iframe not found!");
            return;
        }

        let referrerSource = getReferrerSource();
        let formUrl = "https://charlottehornets.formstack.com/forms/test_utm";
        let queryParams = `?referrer_url=${encodeURIComponent(referrerSource)}`;
        formstackIframe.src = formUrl + queryParams;
        
        console.log("âœ… Updated Formstack URL:", formstackIframe.src);
    }

    window.onload = function () {
        try {
            updateFormstackIframe();
        } catch (error) {
            console.error("ðŸš¨ Error updating Formstack iframe:", error);
        }
    };
});
</script>

=<!DOCTYPE html>
<html lang="en">
<head>
    <title>Embedded Formstack with Referrer Tracking</title>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            function getQueryParam(param) {
                let urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(param);
            }
        
            function getReferrerSource() {
                // 1Ô∏è‚É£ Detect Facebook, Messenger, Instagram
                if (getQueryParam("fbclid")) {
                    return "facebook.com";  
                }
        
                let referrer = document.referrer;
        
                // 2Ô∏è‚É£ Detect email providers
                const emailDomains = [
                    "mail.google.com", "outlook.live.com", "yahoo.com", "icloud.com",
                    "aol.com", "zoho.com", "mail.proton.me", "fastmail.com",
                    "yandex.com", "gmx.com", "mail.com"
                ];
        
                if (referrer) {
                    let referrerDomain = new URL(referrer).hostname;
        
                    if (emailDomains.some(domain => referrerDomain.includes(domain))) {
                        return "email";  // Label as 'email'
                    }
        
                    // 3Ô∏è‚É£ Detect search engines
                    const searchEngines = [
                        "google.com", "bing.com", "duckduckgo.com", "yahoo.com",
                        "baidu.com", "yandex.ru", "ecosia.org"
                    ];
        
                    if (searchEngines.some(engine => referrerDomain.includes(engine))) {
                        return "search";  // Label as 'search'
                    }
        
                    // 4Ô∏è‚É£ Store and update referrer if new
                    let storedReferrer = localStorage.getItem("original_referrer");
                    if (!storedReferrer || storedReferrer !== referrerDomain) {
                        localStorage.setItem("original_referrer", referrerDomain);
                        return referrerDomain;
                    }
        
                    return storedReferrer;
                }
        
                // 5Ô∏è‚É£ Default to direct traffic if no referrer is found
                return "direct";
            }
        
            function updateFormstackIframe() {
                let formstackIframe = document.getElementById("formstack-embed");
                if (!formstackIframe) {
                    console.error("üö® Formstack iframe not found!");
                    return;
                }
        
                let referrerSource = getReferrerSource();
                let formUrl = "https://charlottehornets.formstack.com/forms/test_utm";
                let queryParams = `?referrer_url=${encodeURIComponent(referrerSource)}`;
                formstackIframe.src = formUrl + queryParams;
                
                console.log("‚úÖ Updated Formstack URL:", formstackIframe.src);
            }
        
            // Ensure script runs after full page load
            window.onload = function () {
                setTimeout(updateFormstackIframe, 500); // Small delay to prevent blank page issue
            };
        });
        </script>


</head>
<body>

    <h1>Embedded Formstack Form with Referrer Tracking</h1>
    
    <!-- Formstack form iframe -->
    <iframe id="formstack-embed" 
            src="https://charlottehornets.formstack.com/forms/test_utm" 
            width="100%" 
            height="800px" 
            frameborder="0">
    </iframe>

</body>
</html>
